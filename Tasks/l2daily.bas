DIM HRCOUNTER(24)
DIM PM1AVG(24)
DIM PM25AVG(24)
DIM PM10AVG(24)
DIM HUMIAVG(24)
DIM TEMPAVG(24)   
STRIN=""
CURS=0
TCT=0 
CURS=0 
IJP=0
CSZ=64
LAL=LIST()
BUFFER=""
LISTA=LIST()   
DEF MAX(a,b)
IF a>b THEN RETURN a
RETURN b
ENDIF
ENDDEF
DEF PM2IJP(A,B)
R=MAX(A/60,B/100) * 5
RETURN R
ENDDEF 
DEF TOK(GDZIE,TO_SPLIT )   
CRS=""
SLEN=LEN(TO_SPLIT)-1
FOR ICT=0 TO SLEN
CHARV=MID( TO_SPLIT, ICT , 1 )
IF CHARV <> "," THEN 
CRS=CRS+CHARV 
ELSE  
PUSH(GDZIE,CRS)
CRS="" 
ENDIF
NEXT ICT 
ENDDEF
DEF FNL(STRS)
SLEN=LEN(STRS)-1 
FOR ICT=0 TO SLEN
CCC=MID(STRS,ICT,1)
IF ASC(CCC)=10 THEN RETURN ICT
NEXT ICT
RETURN -1
ENDDEF  
DEF RLN(FLEN)
NEWLINE=""
NBUFFER="" 
IF LEN(BUFFER)<CSZ THEN
NBUFFER=READ(CURS,CSZ)
CURS=CURS+CSZ 
ENDIF
IF CURS+CSZ > FLEN THEN CSZ=FLEN - CURS
IF NBUFFER <> "" THEN  
BUFFER=BUFFER+NBUFFER
ENDIF
POS=FNL(BUFFER)
IF POS <> -1 THEN
NEWLINE=LEFT(BUFFER,POS-1)
ZOSTAW=LEN(BUFFER) - POS - 1
IF ZOSTAW > 0 THEN 
BUFFER=RIGHT(BUFFER,ZOSTAW)
ELSE 
BUFFER=""
ENDIF
ENDIF 
RETURN NEWLINE
ENDDEF 
FNAM=INPUTPAYLOAD  
GETIT=DOWNLOAD(FNAM)
IF GETIT <= 0 THEN EXIT
WHILE TRUE
LINE=RLN(GETIT) 
IF LINE="" THEN EXIT
CLEAR(LAL)
LINE=LINE+","
TOK(LAL,LINE)
EPOCH=GET(LAL,0)
HR=GET(LAL,1)
PM1=GET(LAL,3)
PM25=GET(LAL,4)
PM10=GET(LAL,5)
HUMI=GET(LAL,6)
TEMP=GET(LAL,7)
GOD=VAL(HR)   
HRCOUNTER(GOD)=HRCOUNTER(GOD)+1
PM1AVG(GOD)=PM1AVG(GOD)+VAL(PM1)
PM25AVG(GOD)=PM25AVG(GOD)+VAL(PM25)
PM10AVG(GOD)=PM10AVG(GOD)+VAL(PM10)
HUMIAVG(GOD)=HUMIAVG(GOD)+VAL(HUMI)
TEMPAVG(GOD)=TEMPAVG(GOD)+VAL(TEMP)
WEND  
IJP=0 
FOR I=0 TO 23 
IF HRCOUNTER(I) > 0 THEN    
P1A=PM1AVG(I)/HRCOUNTER(I)
P25A=PM25AVG(I)/HRCOUNTER(I)
P10A=PM10AVG(I)/HRCOUNTER(I)
HA=HUMIAVG(I)/HRCOUNTER(I)
TA=TEMPAVG(I)/HRCOUNTER(I)
IJP=PM2IJP(P25A,P10A)     
ENDIF
NEXT I
IJP=FLOOR(IJP)
OUTPUTPAYLOAD="{"+CHR(34)+"IJP"+CHR(34)+": "+STR(IJP)+"}"
